(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[671],{1941:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/main",function(){return n(5139)}])},5139:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var r=n(5421),o=n(7319);function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||(0,r.Z)(e,t)||(0,o.Z)(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var c=n(1527),s=n(1161),i=n.n(s),u=n(1463),d=n(959),l=n(7160),m=n.n(l);function f(e){var t=e.children,n=e.close,r=e.setClose,o=function(){r(!1)};return(0,c.jsxs)("div",{className:n?"":m().close,children:[(0,c.jsx)("div",{className:m().bg,onClick:o}),(0,c.jsx)("div",{className:m().content,children:t})]})}var h=n(4822),p=n.n(h),_=n(3325),x=n.n(_);function g(){var e=a(d.useState(""),2),t=e[0],n=e[1],r=(0,d.useState)({}),o=r[0],s=r[1],l=(0,u.useRouter)();(0,d.useEffect)(function(){var e,t,n=localStorage.getItem("user");e="stu"==JSON.parse(n).userType?"CourseByStu":"courseByTea",t="stu"==JSON.parse(n).userType?"id=".concat(JSON.parse(n).userId):"teaName=".concat(JSON.parse(n).userName),console.log(e,JSON.parse(n).userType),n||l.push("/index.html"),fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then(function(e){return e.json()}).then(function(e){T(e),N(!0)}),s(JSON.parse(n)),console.log(n)},[]);var m=a(d.useState([]),2),h=m[0],_=m[1],g=(0,d.useState)(!1),v=g[0],N=g[1],y=(0,d.useState)([]),j=y[0],T=y[1],C=function(e){n(e.target.dataset.date),fetch("/course?date=".concat(e.target.dataset.date),{method:"GET"}).then(function(e){return e.json()}).then(function(e){_(e),I(!0)})},b=["1-1","1-2","1-3","1-4","1-5","2-1","2-2","2-3","2-4","2-5","3-1","3-2","3-3","3-4","3-5","4-1","4-2","4-3","4-4","4-5","5-1","5-2","5-3","5-4","5-5","6-1","6-2","6-3","6-4","6-5","7-1","7-2","7-3","7-4","7-5",].map(function(e,t){var n;return(0,c.jsx)("div",{"data-date":e,className:x().item,onClick:C,style:{gridArea:"".concat(e[2],"/").concat(e[0],"/").concat(+e[2]+1,"/").concat(+e[0]+1)},children:null===(n=null==j?void 0:j.find(function(t){return t.courseTime.includes(e)}))||void 0===n?void 0:n.courseName},t)}),S=function(){return v?(0,c.jsx)("main",{className:x().main,children:b}):(0,c.jsx)("div",{children:"loading..."})},w=a(d.useState(!1),2),A=w[0],I=w[1],O=function(e){e.preventDefault(),fetch("/selectCourse",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"courseId=".concat(e.target.dataset.id,"&stuId=").concat(o.userId)}),T(j.concat({courseId:e.target.dataset.id,courseName:e.target.dataset.name,courseTime:t,teaName:e.target.dataset.tea,courseAddress:e.target.dataset.address})),console.log(j)},k=function(e){e.preventDefault(),fetch("/deleteStuCourse",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"courseId=".concat(e.target.dataset.id,"&stuId=").concat(o.userId)}),T(j.filter(function(e){return e.courseTime!==t}))},H=function(e){var t=e.courses,n=e.date,r=e.Courses;console.log(t);var o=null==r?void 0:r.find(function(e){return e.courseTime===n}),a=t.map(function(e,t){return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("div",{className:x().course,children:[(0,c.jsx)("div",{style:{gridArea:"".concat(t+1,"/1/").concat(t+2,"/2")},children:e.courseName}),(0,c.jsx)("div",{style:{gridArea:"".concat(t+1,"/2/").concat(t+2,"/3")},children:e.teaName}),(0,c.jsx)("div",{style:{gridArea:"".concat(t+1,"/3/").concat(t+2,"/4")},children:e.courseAddress}),(0,c.jsx)("button",{"data-id":e.courseId,"data-date":n,"data-name":e.courseName,"data-tea":e.teaName,"data-address":e.courseAddress,onClick:O,disabled:o,style:{gridArea:"".concat(t+1,"/4/").concat(t+2,"/5"),maxWidth:"100px"},children:"选课"})]},t)})});return(0,c.jsxs)("div",{className:x().courses,children:[(0,c.jsxs)("div",{className:x().course,children:[(0,c.jsx)("div",{style:{gridArea:"1/1/2/2"},children:"课程名称"}),(0,c.jsx)("div",{style:{gridArea:"1/2/2/3"},children:"任课教师"}),(0,c.jsx)("div",{style:{gridArea:"1/3/2/4"},children:"课程地址"})]}),a,o?(0,c.jsxs)("div",{className:x().course,children:[(0,c.jsx)("div",{style:{gridArea:"".concat(a.length+2,"/1/").concat(a.length+3,"/2")},children:o.courseName}),(0,c.jsx)("div",{style:{gridArea:"".concat(a.length+2,"/2/").concat(a.length+3,"/3")},children:o.teaName}),(0,c.jsx)("div",{style:{gridArea:"".concat(a.length+2,"/3/").concat(a.length+3,"/4")},children:o.courseAddress}),(0,c.jsx)("button",{"data-id":o.courseId,"data-date":n,"data-name":o.courseName,"data-tea":o.teaName,"data-address":o.courseAddress,onClick:k,style:{gridArea:"".concat(a.length+2,"/4/").concat(a.length+3,"/5"),maxWidth:"100px"},children:"退课"})]},o.courseId):null]})},P="",Z="",D=function(e){P=e.target.value},E=function(e){Z=e.target.value},M=function(e){e.preventDefault(),fetch("/addCourse",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"courseName=".concat(P,"&courseAddress=").concat(Z,"&teaId=").concat(o.userId,"&courseTime=").concat(t,"&teaName=").concat(o.userName)}),T(j.concat({courseId:j.length+1,courseName:P,courseTime:t,teaName:o.userName,courseAddress:Z})),I(!1)},J=function(e){var t=e.date,n=null==j?void 0:j.find(function(e){return e.courseTime.includes(t)}),r=function(){return(0,c.jsxs)("div",{className:x().form,style:{maxWidth:"240px"},children:[(0,c.jsx)("input",{className:p().input,type:"text",placeholder:"课程名称",onChange:D}),(0,c.jsx)("input",{className:p().input,type:"text",placeholder:"课程教室",onChange:E}),(0,c.jsx)("button",{className:p().login,onClick:M,children:"发布"})]})},a=function(){var e=(0,d.useState)((null==n?void 0:n.courseName)||""),r=e[0],a=e[1],s=(0,d.useState)((null==n?void 0:n.courseAddress)||""),i=s[0],u=s[1],l=function(e){a(e.target.value)},m=function(e){u(e.target.value)},f=function(e){e.preventDefault(),fetch("/updateCourse",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"courseId=".concat(n.courseId,"&teaName=").concat(o.userName,"&courseTime=").concat(t,"&courseName=").concat(r,"&courseAddress=").concat(i)}),T(j.filter(function(e){return e.courseTime!==t}).concat({courseId:j.length+1,courseName:r,courseTime:t,teaName:o.userName,courseAddress:i})),I(!A)},h=function(e){e.preventDefault(),fetch("/deleteCourseById",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"id=".concat(n.courseId)}),I(!A),console.log(t),T(j.filter(function(e){return e.courseTime!==t}))};return(0,c.jsxs)("div",{className:x().form,style:{maxWidth:"240px"},children:[(0,c.jsx)("input",{className:p().input,type:"text",value:r,onChange:l}),(0,c.jsx)("input",{className:p().input,type:"text",value:i,onChange:m}),(0,c.jsx)("button",{className:p().login,onClick:f,children:"修改"}),(0,c.jsx)("button",{className:p().login,onClick:h,children:"删除"})]})};return(0,c.jsx)("div",{className:x().center,children:n?(0,c.jsx)(a,{}):(0,c.jsx)(r,{})})},W=function(e){e.preventDefault(),localStorage.removeItem("user"),l.push("/index.html")},R="stu"==o.userType?"deleteStu":"deleteTea",X=function(e){e.preventDefault(),fetch(R,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"id=".concat(o.userId)}),localStorage.removeItem("user"),l.push("/index.html")},B=function(e){var t=e.date;return(0,c.jsx)(H,{courses:h,date:t,Courses:j})},L="stu"==o.userType?(0,c.jsx)(B,{date:t}):(0,c.jsx)(J,{date:t});return(0,c.jsxs)("div",{style:{position:"relative"},children:[(0,c.jsx)(i(),{children:(0,c.jsx)("title",{children:"选课系统"})}),(0,c.jsxs)("h1",{children:["welcome ",o.userName]}),(0,c.jsx)("button",{onClick:W,children:"退出登录"}),(0,c.jsx)("button",{onClick:X,children:"注销"}),(0,c.jsx)(S,{}),(0,c.jsx)(f,{close:A,setClose:I,children:L})]})}},4822:function(e){e.exports={container:"Home_container__bCOhY",input:"Home_input__ZarWZ",login:"Home_login___4DHh",form:"Home_form__k2xMg",main:"Home_main__nLjiQ",footer:"Home_footer____T7K",title:"Home_title__T09hD",description:"Home_description__41Owk",code:"Home_code__suPER",grid:"Home_grid__GxQ85",card:"Home_card___LpL1",logo:"Home_logo__27_tb"}},3325:function(e){e.exports={main:"Main_main__IbvWf",item:"Main_item__JARc6",center:"Main_center__T3EMy",form:"Main_form__4TDFZ",course:"Main_course__uZtOX",open:"Main_open__3qw__"}},7160:function(e){e.exports={close:"modal_close__vM0TR",bg:"modal_bg__hPkR_",content:"modal_content__u9sXU"}},1161:function(e,t,n){e.exports=n(2894)},1463:function(e,t,n){e.exports=n(6070)},8160:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},5421:function(e,t,n){"use strict";function r(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,{Z:function(){return r}})},7319:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(8160);function o(e,t){if(e){if("string"==typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return(0,r.Z)(e,t)}}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=1941)}),_N_E=e.O()}]);